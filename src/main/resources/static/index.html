<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìŠ¤í„°ë”” ê·¸ë£¹ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; }
    .container { max-width: 1200px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    h1, h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    h2 { font-size: 1.5em; margin-top: 30px; }
    nav { background: #333; padding: 10px; text-align: center; margin-bottom: 20px; }
    nav a { color: white; margin: 0 15px; text-decoration: none; font-weight: bold; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .card { padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type="text"], input[type="email"], input[type="password"], input[type="date"], input[type="number"], textarea, select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
    button:hover { background-color: #0056b3; }
    button.delete-btn { background-color: #dc3545; }
    button.delete-btn:hover { background-color: #c82333; }
    #login-section, #dashboard-section { padding: 20px; border: 1px solid #eee; margin-top: 20px; }
    #dashboard-section { display: none; }
    .item-list { list-style-type: none; padding: 0; }
    .item-list li { background: #f9f9f9; padding: 10px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
  </style>
</head>
<body>

<div class="container">
  <h1>ğŸ“š ìŠ¤í„°ë”” ê·¸ë£¹ í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œ</h1>
  <nav>
    <a href="/signup.html" target="_blank">íšŒì›ê°€ì…</a>
    <a href="/private-chat.html" target="_blank">1:1 ì±„íŒ…</a>
  </nav>

  <div id="login-section">
    <h2>ë¡œê·¸ì¸ ë° ê³„ì • ê´€ë¦¬</h2>
    <form id="login-form">
      <div class="form-group">
        <label for="login-email">ì´ë©”ì¼:</label>
        <input type="email" id="login-email" required>
      </div>
      <div class="form-group">
        <label for="login-password">ë¹„ë°€ë²ˆí˜¸:</label>
        <input type="password" id="login-password" required>
      </div>
      <button type="submit">ë¡œê·¸ì¸</button>
      <button type="button" id="logout-btn" style="display:none; background-color: #6c757d;">ë¡œê·¸ì•„ì›ƒ</button>
      <button type="button" id="delete-me-btn" class="delete-btn" style="display:none; margin-left: 10px;">íšŒì› íƒˆí‡´</button>
    </form>
    <p id="auth-status">ë¡œê·¸ì¸ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒë¨</p>
  </div>

  <div id="dashboard-section">
    <hr>
    <div class="card">
      <h2>ê²Œì‹œíŒ ê´€ë¦¬ (BoardController)</h2>
      <form id="board-create-form">
        <input type="text" id="board-title" placeholder="ì œëª©" required><br><br>
        <textarea id="board-content" placeholder="ë‚´ìš©" required></textarea><br><br>
        <input type="text" id="board-category" placeholder="ì¹´í…Œê³ ë¦¬ ì´ë¦„" required><br><br>
        <select id="board-status">
          <option value="RECRUITING">ëª¨ì§‘ì¤‘</option>
          <option value="COMPLETED">ëª¨ì§‘ì™„ë£Œ</option>
        </select><br><br>
        <button type="submit">ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</button>
      </form>
      <h3>ê²Œì‹œê¸€ ëª©ë¡</h3>
      <ul id="board-list" class="item-list"></ul>
    </div>

    <div class="card">
      <h2>ìŠ¤í„°ë”” í”Œëœ ê´€ë¦¬ (StudyPlanController)</h2>
      <form id="plan-create-form">
        <input type="text" id="plan-title" placeholder="ê³„íš ì œëª©" required><br><br>
        <textarea id="plan-description" placeholder="ìƒì„¸ ë‚´ìš©"></textarea><br><br>
        <label>ì‹œì‘ì¼:</label><input type="date" id="plan-start-date" required><br><br>
        <label>ì¢…ë£Œì¼:</label><input type="date" id="plan-end-date" required><br><br>
        <label>ì™„ë£Œ ì—¬ë¶€:</label><input type="checkbox" id="plan-is-complete"><br><br>
        <button type="submit">ìƒˆ ê³„íš ì¶”ê°€</button>
      </form>
      <h3>ë‚´ ìŠ¤í„°ë”” í”Œëœ</h3>
      <ul id="plan-list" class="item-list"></ul>
    </div>

    <div class="card">
      <h2>ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ (CategoryController)</h2>
      <form id="category-create-form">
        <input type="text" id="category-name" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„" required>
        <button type="submit">ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
      </form>
      <h3>ì¹´í…Œê³ ë¦¬ ëª©ë¡</h3>
      <ul id="category-list" class="item-list"></ul>
    </div>

    <div class="card">
      <h2>íŒ”ë¡œìš° ê´€ë¦¬ (FollowController)</h2>
      <form id="follow-form">
        <input type="number" id="followee-id" placeholder="íŒ”ë¡œìš°í•  ì‚¬ìš©ìì˜ ID" required>
        <button type="submit">íŒ”ë¡œìš°</button>
      </form>
      <form id="unfollow-form" style="margin-top:10px;">
        <input type="number" id="unfollowee-id" placeholder="ì–¸íŒ”ë¡œìš°í•  ì‚¬ìš©ìì˜ ID" required>
        <button type="submit" class="delete-btn">ì–¸íŒ”ë¡œìš°</button>
      </form>
      <br>
      <button onclick="fetchFollowers()">ë‚´ íŒ”ë¡œì›Œ ë³´ê¸°</button>
      <button onclick="fetchFollowing()">ë‚´ê°€ íŒ”ë¡œì‰í•˜ëŠ” ì‚¬ìš©ì ë³´ê¸°</button>
      <h3>íŒ”ë¡œì›Œ</h3>
      <ul id="follower-list" class="item-list"></ul>
      <h3>íŒ”ë¡œì‰</h3>
      <ul id="following-list" class="item-list"></ul>
    </div>
  </div>
</div>

<script>
  // ì „ì—­ ë³€ìˆ˜
  const apiBaseUrl = ''; // ë™ì¼ ì¶œì²˜ì´ë¯€ë¡œ ì „ì²´ URL ìƒëµ ê°€ëŠ¥

  // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
  const fetchAPI = async (url, options = {}) => {
    options.headers = {
      'Content-Type': 'application/json',
      ...options.headers
    };

    const response = await fetch(apiBaseUrl + url, options);
    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
    }
    if (response.status === 204) {
      return null;
    }
    return response.json();
  };

  // --- ì¸ì¦ ê´€ë ¨ ---
  document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const authStatus = document.getElementById('auth-status');
    const details = new URLSearchParams();
    details.append('email', email);
    details.append('password', password);

    try {
      const response = await fetch('/api/users/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: details
      });

      if (response.ok) {
        authStatus.textContent = `ë¡œê·¸ì¸ ìƒíƒœ: ${email}`;
        authStatus.style.color = 'green';
        document.getElementById('dashboard-section').style.display = 'block';
        document.getElementById('logout-btn').style.display = 'inline-block';
        document.getElementById('delete-me-btn').style.display = 'inline-block'; // íƒˆí‡´ ë²„íŠ¼ í‘œì‹œ
        fetchAllData();
      } else {
        throw new Error(await response.text() || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
      }
    } catch (error) {
      authStatus.textContent = `ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}`;
      authStatus.style.color = 'red';
    }
  });

  const handleLogout = () => {
    document.getElementById('auth-status').textContent = 'ë¡œê·¸ì¸ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒë¨';
    document.getElementById('auth-status').style.color = 'black';
    document.getElementById('dashboard-section').style.display = 'none';
    document.getElementById('logout-btn').style.display = 'none';
    document.getElementById('delete-me-btn').style.display = 'none'; // íƒˆí‡´ ë²„íŠ¼ ìˆ¨ê¹€
    document.getElementById('login-form').reset();
  };

  document.getElementById('logout-btn').addEventListener('click', async () => {
    await fetch('/api/users/logout', { method: 'POST' });
    handleLogout();
  });

  // íšŒì› íƒˆí‡´ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
  document.getElementById('delete-me-btn').addEventListener('click', async () => {
    if (confirm('ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      try {
        await fetchAPI('/api/users/me', { method: 'DELETE' });
        alert('íšŒì› íƒˆí‡´ê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        handleLogout(); // UIë¥¼ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ ë³€ê²½
      } catch (error) {
        alert(`íšŒì› íƒˆí‡´ ì‹¤íŒ¨: ${error.message}`);
      }
    }
  });


  // --- ë°ì´í„° ë¡œë“œ ---
  function fetchAllData() {
    fetchBoards();
    fetchCategories();
    fetchStudyPlans();
    fetchFollowers();
    fetchFollowing();
  }

  async function fetchBoards() {
    try {
      const boards = await fetchAPI('/api/boards');
      const list = document.getElementById('board-list');
      list.innerHTML = '';
      boards.forEach(b => {
        const item = document.createElement('li');
        item.innerHTML = `<span><strong>${b.title}</strong> by ${b.username} <i>(${b.category})</i></span>
                              <button class="delete-btn" onclick="deleteBoard(${b.id})">ì‚­ì œ</button>`;
        list.appendChild(item);
      });
    } catch (error) { console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error); }
  }

  async function fetchCategories() {
    try {
      const categories = await fetchAPI('/api/categories');
      const list = document.getElementById('category-list');
      list.innerHTML = '';
      categories.forEach(c => {
        const item = document.createElement('li');
        item.innerHTML = `<span>${c.name} (ID: ${c.id})</span>
                              <button class="delete-btn" onclick="deleteCategory(${c.id})">ì‚­ì œ</button>`;
        list.appendChild(item);
      });
    } catch (error) { console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error); }
  }

  async function fetchStudyPlans() {
    try {
      const plans = await fetchAPI('/api/studyplans');
      const list = document.getElementById('plan-list');
      list.innerHTML = '';
      plans.forEach(p => {
        const item = document.createElement('li');
        item.innerHTML = `<span><strong>${p.title}</strong> (${p.startDate} ~ ${p.endDate}) - ${p.isComplete ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘'}</span>
                              <button class="delete-btn" onclick="deletePlan(${p.id})">ì‚­ì œ</button>`;
        list.appendChild(item);
      });
    } catch (error) { console.error('ìŠ¤í„°ë”” ê³„íš ë¡œë“œ ì‹¤íŒ¨:', error); }
  }

  async function fetchFollowers() {
    try {
      const followers = await fetchAPI('/api/follows/followers');
      const list = document.getElementById('follower-list');
      list.innerHTML = '';
      followers.forEach(f => {
        const item = document.createElement('li');
        item.textContent = `${f.followerUsername} ë‹˜ì´ íŒ”ë¡œìš°í•©ë‹ˆë‹¤.`;
        list.appendChild(item);
      });
    } catch (error) { console.error('íŒ”ë¡œì›Œ ë¡œë“œ ì‹¤íŒ¨:', error); }
  }

  async function fetchFollowing() {
    try {
      const followings = await fetchAPI('/api/follows/following');
      const list = document.getElementById('following-list');
      list.innerHTML = '';
      followings.forEach(f => {
        const item = document.createElement('li');
        item.textContent = `ë‚´ê°€ ${f.followeeUsername} ë‹˜ì„ íŒ”ë¡œìš°í•©ë‹ˆë‹¤.`;
        list.appendChild(item);
      });
    } catch (error) { console.error('íŒ”ë¡œì‰ ë¡œë“œ ì‹¤íŒ¨:', error); }
  }

  // --- ë°ì´í„° ìƒì„±/ì‚­ì œ ---

  // ê²Œì‹œíŒ
  document.getElementById('board-create-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
      title: document.getElementById('board-title').value,
      content: document.getElementById('board-content').value,
      category: document.getElementById('board-category').value,
      status: document.getElementById('board-status').value,
    };
    try {
      await fetchAPI('/api/boards', { method: 'POST', body: JSON.stringify(data) });
      fetchBoards();
      e.target.reset();
    } catch (error) { alert(`ê²Œì‹œê¸€ ìƒì„± ì‹¤íŒ¨: ${error.message}`); }
  });

  async function deleteBoard(id) {
    if (confirm(`ê²Œì‹œê¸€ ID ${id}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      try {
        await fetchAPI(`/api/boards/${id}`, { method: 'DELETE' });
        fetchBoards();
      } catch (error) { alert(`ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`); }
    }
  }

  // ì¹´í…Œê³ ë¦¬
  document.getElementById('category-create-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = { name: document.getElementById('category-name').value };
    try {
      await fetchAPI('/api/categories', { method: 'POST', body: JSON.stringify(data) });
      fetchCategories();
      e.target.reset();
    } catch (error) { alert(`ì¹´í…Œê³ ë¦¬ ìƒì„± ì‹¤íŒ¨: ${error.message}`); }
  });

  async function deleteCategory(id) {
    if (confirm(`ì¹´í…Œê³ ë¦¬ ID ${id}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      try {
        await fetchAPI(`/api/categories/${id}`, { method: 'DELETE' });
        fetchCategories();
        fetchBoards();
      } catch (error) { alert(`ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`); }
    }
  }

  // ìŠ¤í„°ë”” í”Œëœ
  document.getElementById('plan-create-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
      title: document.getElementById('plan-title').value,
      description: document.getElementById('plan-description').value,
      startDate: document.getElementById('plan-start-date').value,
      endDate: document.getElementById('plan-end-date').value,
      isComplete: document.getElementById('plan-is-complete').checked,
    };
    try {
      await fetchAPI('/api/studyplans', { method: 'POST', body: JSON.stringify(data) });
      fetchStudyPlans();
      e.target.reset();
    } catch (error) { alert(`ê³„íš ìƒì„± ì‹¤íŒ¨: ${error.message}`); }
  });

  async function deletePlan(id) {
    if (confirm(`ê³„íš ID ${id}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      try {
        await fetchAPI(`/api/studyplans/${id}`, { method: 'DELETE' });
        fetchStudyPlans();
      } catch (error) { alert(`ê³„íš ì‚­ì œ ì‹¤íŒ¨: ${error.message}`); }
    }
  }

  // íŒ”ë¡œìš°
  document.getElementById('follow-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = { followeeId: parseInt(document.getElementById('followee-id').value) };
    try {
      await fetchAPI('/api/follows', { method: 'POST', body: JSON.stringify(data) });
      fetchFollowers();
      fetchFollowing();
      e.target.reset();
    } catch (error) { alert(`íŒ”ë¡œìš° ì‹¤íŒ¨: ${error.message}`); }
  });

  document.getElementById('unfollow-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = { followeeId: parseInt(document.getElementById('unfollowee-id').value) };
    try {
      await fetchAPI('/api/follows', { method: 'DELETE', body: JSON.stringify(data) });
      fetchFollowers();
      fetchFollowing();
      e.target.reset();
    } catch (error) { alert(`ì–¸íŒ”ë¡œìš° ì‹¤íŒ¨: ${error.message}`); }
  });

</script>

</body>
</html>